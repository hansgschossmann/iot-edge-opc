version: '3'

services:
    publisher:
        image: ${OPCPUBLISHER_CONTAINER}
        restart: always
        container_name: pub-${DOMAIN}
        hostname: pub-${DOMAIN}
        extra_hosts:
            ${EXTRAHOSTS}
        volumes:
            - "cfx509certstores:/root/.dotnet/corefx/cryptography/x509stores"
            - "${BINDSOURCE}:/d"
        expose:
            - "62222"
        command: pub-${DOMAIN} --pf /d/pn-${DOMAIN}.json ${TELEMETRYCONFIG_OPTION} --lf /d/${DOMAIN}-pub.log --domain ${DOMAIN} --di=60 --tp /d/trusted --rp /d/rejected --ip /d/issuer --to
           
    proxy:
        image: ${OPCPROXY_CONTAINER}
        restart: always
        container_name: prx-${DOMAIN}
        hostname: prx-${DOMAIN}
        extra_hosts:
            ${EXTRAHOSTS}
        volumes:
            - "cfx509certstores:/root/.dotnet/corefx/cryptography/x509stores"
            - "${BINDSOURCE}:/d"
        command: -w --domain ${DOMAIN} -l /d/${DOMAIN}-prx.log -D /d/prx-${DOMAIN}-cs.db

volumes:
    cfx509certstores:
    cfappdata: